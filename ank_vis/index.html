<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript" src="d3.v2.min.js"></script>

  <style type="text/css">
    circle {
      fill: steelblue;
    }


     .chart div {
   font: 10px sans-serif;
   background-color: steelblue;
   text-align: right;
   padding: 3px;
   margin: 1px;
   color: white;
 }
  </style>

  </head>
  <body>
    <script type="text/javascript">

  var chart = d3.select("body").append("svg")
     .attr("class", "chart")
     .attr("width", 1000)
     .attr("height", 1000);

  var nodes = d3.map;

  var icon_ordinal = d3.scale.ordinal()
      .domain(["router", "switch", "collision_domain"])
      .range(["router.svg", "switch.svg", "switch.svg"]);

      var icon = function(d) {
        return icon_ordinal(d.device_type);
     }

  var source_x = function(d) {
    return nodes[d.source].x + 32;
  }
  var source_y = function(d) {
    return nodes[d.source].y + 32;
  }

  var target_x = function(d) {
    return nodes[d.target].x + 32;
  }
  var target_y = function(d) {
    return nodes[d.target].y + 32;
  }

  d3.json(
  'data/ip',
  function (jsondata) {

    // create the chart here with
    // the returned data

    console.log(jsondata);
    console.log(jsondata.nodes);

    nodes = jsondata.nodes;

    jsondata.links.forEach( function(d) {
      console.log(d);
      });

    //TODO: filter the json data x and y ranges: store in nodes, and use this for the image plotting

    chart.selectAll("line")
    .data(jsondata.links)
    .enter().append("line")
    .attr("x1", source_x)
    .attr("y1", source_y)
    .attr("x2", target_x)
    .attr("y2", target_y)
    .style("stroke", "rgb(6,120,155)");

    chart.selectAll("image")
      .data(nodes)
      .enter().append("image")
      .attr("x", function(d) { return d.x; })
      .attr("y", function(d) { return d.y; })
      .attr("xlink:href", icon)
      .attr("width", 64)
      .attr("height", 64);
      
  chart.selectAll("text")
      .data(jsondata.nodes)
    .enter().append("text")
      .attr("x", function(d) { return d.x; })
      .attr("y", function(d) { return d.y; } )
      .attr("dx", 32) // padding-right
      .attr("dy", 65) // vertical-align: middle
      .attr("text-anchor", "middle") 
      .attr("font-family", "helvetica") 
      .attr("font-size", "small") 
      .text(function (d) { return d.id; } );
  });

//TODO: set hover to display properties

    </script>
  </body>
</html>
